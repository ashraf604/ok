const { formatNumber } = require(\"./database_helpers.js\");\n\nfunction formatPrivateBuy(details) {\n    const { asset, price, amountChange, tradeValue, oldTotalValue, newAssetWeight, newUsdtValue, newCashPercent } = details;\n    const tradeSizePercent = oldTotalValue > 0 ? (tradeValue / oldTotalValue) * 100 : 0;\n\n    let msg = `*Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£ØµÙˆÙ„ ðŸ”¬:*\\n**Ø¹Ù…Ù„ÙŠØ© Ø§Ø³ØªØ­ÙˆØ§Ø° Ø¬Ø¯ÙŠØ¯Ø© ðŸŸ¢**\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\n    msg += `ðŸ”¸ **Ø§Ù„Ø£ØµÙ„ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù:** \\`${asset}/USDT\\`\\n`;\n    msg += `ðŸ”¸ **Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:** ØªØ¹Ø²ÙŠØ² Ù…Ø±ÙƒØ² / Ø¨Ù†Ø§Ø¡ Ù…Ø±ÙƒØ² Ø¬Ø¯ÙŠØ¯\\n`;\n    msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n*ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙÙ‚Ø©:*\\n`;\n    msg += ` â–ªï¸ **Ø³Ø¹Ø± Ø§Ù„ØªÙ†ÙÙŠØ°:** \\`$${formatNumber(price, 4)}\\`\\n`;\n    msg += ` â–ªï¸ **Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¶Ø§ÙØ©:** \\`${formatNumber(Math.abs(amountChange), 6)}\\`\\n`;\n    msg += ` â–ªï¸ **Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„ØµÙÙ‚Ø©:** \\`$${formatNumber(tradeValue)}\\`\\n`;\n    msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n*Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø­ÙØ¸Ø©:*\\n`;\n    msg += ` â–ªï¸ **Ø­Ø¬Ù… Ø§Ù„ØµÙÙ‚Ø© Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø©:** \\`${formatNumber(tradeSizePercent)}%\\`\\n`;\n    msg += ` â–ªï¸ **Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø£ØµÙ„:** \\`${formatNumber(newAssetWeight)}%\\`\\n`;\n    msg += ` â–ªï¸ **Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© (USDT):** \\`$${formatNumber(newUsdtValue)}\\`\\n`;\n    msg += ` â–ªï¸ **Ù…Ø¤Ø´Ø± Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠ:** \\`${formatNumber(newCashPercent)}%\\`\\n`;\n    msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n*Ø¨ØªØ§Ø±ÙŠØ®:* ${new Date().toLocaleString(\"ar-EG\", { timeZone: \"Africa/Cairo\" })}`;\n    return msg;\n}\n\nfunction formatPrivateSell(details) {\n    const { asset, price, amountChange, tradeValue, oldTotalValue, newAssetWeight, newUsdtValue, newCashPercent } = details;\n    const tradeSizePercent = oldTotalValue > 0 ? (tradeValue / oldTotalValue) * 100 : 0;\n    \n    let msg = `*Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£ØµÙˆÙ„ ðŸ”¬:*\\n**Ù…Ù†Ø§ÙˆØ±Ø© ØªÙƒØªÙŠÙƒÙŠØ© ðŸŸ **\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\n    msg += `ðŸ”¸ **Ø§Ù„Ø£ØµÙ„ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù:** \\`${asset}/USDT\\`\\n`;\n    msg += `ðŸ”¸ **Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:** ØªØ®ÙÙŠÙ Ø§Ù„Ù…Ø±ÙƒØ² / Ø¬Ù†ÙŠ Ø£Ø±Ø¨Ø§Ø­ Ø¬Ø²Ø¦ÙŠ\\n`;\n    msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n*ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙÙ‚Ø©:*\\n`;\n    msg += ` â–ªï¸ **Ø³Ø¹Ø± Ø§Ù„ØªÙ†ÙÙŠØ°:** \\`$${formatNumber(price, 4)}\\`\\n`;\n    msg += ` â–ªï¸ **Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø®ÙÙØ©:** \\`${formatNumber(Math.abs(amountChange), 6)}\\`\\n`;\n    msg += ` â–ªï¸ **Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„ØµÙÙ‚Ø©:** \\`$${formatNumber(tradeValue)}\\`\\n`;\n    msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n*Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø­ÙØ¸Ø©:*\\n`;\n    msg += ` â–ªï¸ **Ø­Ø¬Ù… Ø§Ù„ØµÙÙ‚Ø© Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø©:** \\`${formatNumber(tradeSizePercent)}%\\`\\n`;\n    msg += ` â–ªï¸ **Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø£ØµÙ„:** \\`${formatNumber(newAssetWeight)}%\\`\\n`;\n    msg += ` â–ªï¸ **Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (USDT):** \\`$${formatNumber(newUsdtValue)}\\`\\n`;\n    msg += ` â–ªï¸ **Ù…Ø¤Ø´Ø± Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠ:** \\`${formatNumber(newCashPercent)}%\\`\\n`;\n    msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n*Ø¨ØªØ§Ø±ÙŠØ®:* ${new Date().toLocaleString(\"ar-EG\", { timeZone: \"Africa/Cairo\" })}`;\n    return msg;\n}\n\nfunction formatPrivateCloseReport(details) {\n    const { asset, avgBuyPrice, avgSellPrice, pnl, pnlPercent, durationDays, highestPrice, lowestPrice } = details;\n    const pnlSign = pnl >= 0 ? \u2018+\u2019 : \u2018\u2019;\n    const emoji = pnl >= 0 ? \u2018\uD83D\uDFE2\u2019 : \u2018\uD83D\uDD34\u2019;\n\n    let msg = `*Ù…Ù„Ù Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø®ØªØ§Ù…ÙŠ ${emoji}*\\n**${asset}/USDT**\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\n    msg += `ðŸ”¸ **Ù…ØªÙˆØ³Ø· Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡:** \\`$${formatNumber(avgBuyPrice, 4)}\\`\\n`;\n    msg += `ðŸ”¸ **Ù…ØªÙˆØ³Ø· Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹:** \\`$${formatNumber(avgSellPrice, 4)}\\`\\n`;\n    msg += `ðŸ”¸ **Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ù‚Ù‚Ø©:** \\`${pnlSign}$${formatNumber(pnl)}\\` (${pnlSign}${formatNumber(pnlPercent)}%)\\n`;\n    msg += `ðŸ”¸ **Ù…Ø¯Ø© Ø§Ù„ØµÙÙ‚Ø©:** \\`${formatNumber(durationDays, 1)}\\` ÙŠÙˆÙ…\\n`;\n    msg += `ðŸ”¸ **Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± Ø®Ù„Ø§Ù„ Ø§Ù„ØµÙÙ‚Ø©:** \\`$${formatNumber(highestPrice, 4)}\\`\\n`;\n    msg += `ðŸ”¸ **Ø£Ø¯Ù†Ù‰ Ø³Ø¹Ø± Ø®Ù„Ø§Ù„ Ø§Ù„ØµÙÙ‚Ø©:** \\`$${formatNumber(lowestPrice, 4)}\\`\\n`;\n    msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n*Ø¨ØªØ§Ø±ÙŠØ®:* ${new Date().toLocaleString(\"ar-EG\", { timeZone: \"Africa/Cairo\" })}`;\n    return msg;\n}\n\nfunction formatPortfolioMessage(portfolio, prices) {\n    let msg = `*ðŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø­ÙØ¸Ø© (${new Date().toLocaleDateString(\"ar-EG\", { timeZone: \"Africa/Cairo\" })}):*\\n\\n`;\n    if (portfolio.error) {\n        msg += `âš ï¸ ${portfolio.error}\\n`;\n        return msg;\n    }\n\n    msg += `*Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:* \\`$${formatNumber(portfolio.total)}\\`\\n`;\n    msg += `*Ø§Ù„Ø³ÙŠÙˆÙ„Ø© (USDT):* \\`$${formatNumber(portfolio.usdtValue)}\\`\\n\\n`;\n\n    if (portfolio.assets.length > 0) {\n        msg += `*Ø§Ù„Ø£ØµÙˆÙ„:*\n`;\n        portfolio.assets.forEach(asset => {\n            const changeEmoji = asset.change24h >= 0 ? (asset.change24h > 0 ? 'ðŸ“ˆ' : '') : 'ðŸ“‰';\n            const changeText = asset.change24h !== 0 ? ` (${formatNumber(asset.change24h * 100, 2)}%)` : '';\n            msg += `\u2022 ${asset.asset}: \\`$${formatNumber(asset.value)}\\` (${formatNumber(asset.amount, 4)} ${asset.asset}) ${changeEmoji}${changeText}\\n`;\n        });\n    } else {\n        msg += `Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙˆÙ„ ÙÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.\\n`;\n    }\n    return msg;\n}\n\nfunction formatDailySummary(summary) {\n    let msg = `*ðŸ“ˆ Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…ÙŠ (${new Date().toLocaleDateString(\"ar-EG\", { timeZone: \"Africa/Cairo\" })}):*\\n\\n`;\n    if (summary.error) {\n        msg += `âš ï¸ ${summary.error}\\n`;\n        return msg;\n    }\n\n    const pnlEmoji = summary.pnl >= 0 ? 'ðŸŸ¢' : 'ðŸ”´';\n    const pnlSign = summary.pnl >= 0 ? '+' : '';\n\n    msg += `*Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ©:* \\`$${formatNumber(summary.startValue)}\\`\\n`;\n    msg += `*Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØªØ§Ù…ÙŠØ©:* \\`$${formatNumber(summary.endValue)}\\`\\n`;\n    msg += `*Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:* ${pnlEmoji} \\`${pnlSign}$${formatNumber(summary.pnl)}\\` (${pnlSign}${formatNumber(summary.pnlPercent)}%)\\n`;\n    msg += `*Ø£Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø©:* \\`$${formatNumber(summary.maxValue)}\\`\\n`;\n    msg += `*Ø£Ø¯Ù†Ù‰ Ù‚ÙŠÙ…Ø©:* \\`$${formatNumber(summary.minValue)}\\`\\n\\n`;\n\n    if (summary.chartUrl) {\n        msg += `[Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ](${summary.chartUrl})\\n`;\n    }\n\n    return msg;\n}\n\nfunction formatTechnicalAnalysisMessage(instId, analysis) {\n    let msg = `*ØªØ­Ù„ÙŠÙ„ ÙÙ†ÙŠ Ù„Ù€ ${instId.toUpperCase()}*\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\n    if (analysis.error) {\n        msg += `âš ï¸ ${analysis.error}\\n`;\n        return msg;\n    }\n\n    msg += `ðŸ”¸ *Ù…Ø¤Ø´Ø± Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù†Ø³Ø¨ÙŠØ© (RSI):* \\`${formatNumber(analysis.rsi, 2)}\\`\\n`;\n    msg += `ðŸ”¸ *Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…ØªØ­Ø±Ùƒ Ø§Ù„Ø¨Ø³ÙŠØ· (SMA20):* \\`$${formatNumber(analysis.sma20, 4)}\\`\\n`;\n    msg += `ðŸ”¸ *Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…ØªØ­Ø±Ùƒ Ø§Ù„Ø¨Ø³ÙŠØ· (SMA50):* \\`$${formatNumber(analysis.sma50, 4)}\\`\\n`;\n    msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\n    return msg;\n}\n\nfunction formatPriceAlertMessage(alert) {\n    return `ðŸ”” *ØªÙ†Ø¨ÙŠÙ‡ Ø³Ø¹Ø±:*\\nØ§Ù„Ø£ØµÙ„: *${alert.instId}*\\nØ§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: \\`$${formatNumber(alert.currentPrice, 4)}\\`\\nØ§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù: \\`$${formatNumber(alert.targetPrice, 4)}\\`\\nØ§Ù„Ø§ØªØ¬Ø§Ù‡: *${alert.direction === 'above' ? 'Ø£Ø¹Ù„Ù‰ Ù…Ù†' : 'Ø£Ù‚Ù„ Ù…Ù†'}*\\n`;\n}\n\nfunction formatVirtualTradeSummary(trade) {\n    let msg = `*ØµÙÙ‚Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© ðŸ“Š*\\n`;\n    msg += `Ø§Ù„Ø£ØµÙ„: *${trade.asset}*\\n`;\n    msg += `Ø§Ù„ÙƒÙ…ÙŠØ©: \\`${formatNumber(trade.amount, 4)}\\`\\n`;\n    msg += `Ø³Ø¹Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„: \\`$${formatNumber(trade.entryPrice, 4)}\\`\\n`;\n    msg += `ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„: ${new Date(trade.enteredAt).toLocaleString(\"ar-EG\", { timeZone: \"Africa/Cairo\" })}\\n`;\n    msg += `Ø§Ù„Ø­Ø§Ù„Ø©: *${trade.status}*\\n`;\n    if (trade.status === 'closed') {\n        msg += `Ø³Ø¹Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚: \\`$${formatNumber(trade.closePrice, 4)}\\`\\n`;\n        msg += `ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØºÙ„Ø§Ù‚: ${new Date(trade.closedAt).toLocaleString(\"ar-EG\", { timeZone: \"Africa/Cairo\" })}\\n`;\n        const pnl = (trade.closePrice - trade.entryPrice) * trade.amount;\n        const pnlPercent = (pnl / (trade.entryPrice * trade.amount)) * 100;\n        const pnlEmoji = pnl >= 0 ? 'ðŸŸ¢' : 'ðŸ”´';\n        const pnlSign = pnl >= 0 ? '+' : '';\n        msg += `Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø©: ${pnlEmoji} \\`${pnlSign}$${formatNumber(pnl)}\\` (${pnlSign}${formatNumber(pnlPercent)}%)\\n`;\n    }\n    return msg;\n}\n\nmodule.exports = {\n    formatPrivateBuy,\n    formatPrivateSell,\n    formatPrivateCloseReport,\n    formatPortfolioMessage,\n    formatDailySummary,\n    formatTechnicalAnalysisMessage,\n    formatPriceAlertMessage,\n    formatVirtualTradeSummary\n};

